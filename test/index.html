<!DOCTYPE html>
<meta charset=UTF-8>
<meta name=robots content="noindex,nofollow">
<meta name=viewport content="width=device-width,maximum-scale=1">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="black">
<meta name=apple-mobile-web-app-title content="test">
<link rel=apple-touch-icon href="/img/icon180.png">
<link rel=stylesheet href="style.css">
<link rel=manifest href="manifest.json">
<script>
"use strict";
onerror = function(m, s, l, c, e){alert(m + "\n\n" + e.stack)};
if("serviceWorker" in navigator){
  navigator.serviceWorker.onmessage = function(e){
    alert(e.data.txt);
  };
}
function register(url){
  if("serviceWorker" in navigator){
    navigator.serviceWorker.register(url).then(function(reg){
      alert(
        "scope " + reg.scope +
        "\ninstalling " + reg.installing +
        "\nwaiting " + reg.waiting +
        "\nactive " + reg.active
      );
      if(reg.waiting) showUpdateMessage(reg);
      reg.onupdatefound = function(){
        reg.installing.onstatechange = function(){
          if(this.state === "installed" && navigator.serviceWorker.controller) showUpdateMessage(reg);
        };
      };
    });
  }
}
function showUpdateMessage(reg){
  var o = _("un");
  _("ub").onclick = function(){
    o.style.display = "none";
    if(!reg.waiting) return;
    reg.waiting.postMessage("skipWaiting");
    location.reload();
  };
  o.style.display = "block";
}
function checkUpdate(){
  if("serviceWorker" in navigator){
    navigator.serviceWorker.getRegistration().then(function(reg){
      if(reg) reg.update();
    });
  }
}
onload = function(){
  register("sw.js");
};
</script>
<h1>テスト用ページです</h1>
